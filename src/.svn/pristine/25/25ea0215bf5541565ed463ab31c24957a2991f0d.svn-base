/**
 * Client class for the minigame game. Client sends a request to connect to the game server on port 4000. The client can
 * then interact using I/O with the server
 *
 * @author Connor Wilkes
 * @version 1/3/2018s
 */

package Server;

import Login.User;
import org.postgresql.util.ReaderInputStream;

import java.io.*;
import java.net.InetAddress;
import java.net.Socket;
import java.util.logging.Level;
import java.util.logging.Logger;

public class Client {

    final private int port = 4000;
    private User user;
    private Socket connection;
    private InetAddress destination;
    private InputStream in;
    private OutputStream out;
    private final static Logger errorLogger = Logger.getLogger("errors");

    /**
     * Constructor for the Client class
     *
     * @param user        user associated with the class
     * @param destination destination of the connection (IP address or DSN)
     */
    public Client(User user, InetAddress destination) {
        this.user = user;
        this.destination = destination;
    }

    /**
     * Getter for the user variable
     *
     * @return class's user
     */
    public User getUser() {
        return user;
    }

    public Socket getConnection() {
        return connection;
    }

    /**
     * Connects to a server
     */
    public void connect() {
        try (Socket socket = new Socket(destination, port)) {
            connection = socket;
            in = socket.getInputStream();
            out = connection.getOutputStream();
            ObjectOutputStream objectOut = new ObjectOutputStream(out);
            objectOut.writeObject(this.user);
            out.flush();
            System.out.println(readFromServer());
            socket.close();
        } catch (IOException ex) {
            errorLogger.log(Level.SEVERE, "Could not connect", ex);
        }
    }

    /**
     * Helper method to read Strings from a server
     *
     * @return
     * @throws IOException
     */
    public String readFromServer() throws IOException {
        if (in == null) {
            System.err.println("No inputstream");
            return " ";
        } else if (connection == null) {
            System.err.println("No connection");
            return " ";
        } else {
            StringBuilder message = new StringBuilder();
            BufferedReader reader = new BufferedReader(new InputStreamReader(in, "ASCII"));
            message.append(reader.readLine());
            return message.toString();
        }
    }

    /**
     * Main method to start the client connection
     *
     * @param args command line arguments z
     */
    public static void main(String[] args) {
        User testUser = new User("a", "b", "c");
        try {
            Client testClient = new Client(testUser, InetAddress.getLocalHost());
            testClient.connect();
        } catch (IOException ex) {

        }

    }


}
